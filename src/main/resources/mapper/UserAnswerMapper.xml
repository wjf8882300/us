<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.runxsports.provider.cs.cms.mapper.UserAnswerMapper" >
  <resultMap id="BaseResultMap" type="com.runxsports.provider.cs.cms.entity.UserAnswer" >
    <!--
      WARNING - @mbg.generated
    -->
    <id column="id" property="id" jdbcType="BIGINT" />
    <result column="question_id" property="questionId" jdbcType="BIGINT" />
    <result column="user_id" property="userId" jdbcType="BIGINT" />
    <result column="dest_user_id" property="destUserId" jdbcType="BIGINT" />
    <result column="answer" property="answer" jdbcType="VARCHAR" />
    <result column="create_date" property="createDate" jdbcType="TIMESTAMP" />
    <result column="create_user" property="createUser" jdbcType="BIGINT" />
    <result column="last_update_date" property="lastUpdateDate" jdbcType="TIMESTAMP" />
    <result column="last_update_user" property="lastUpdateUser" jdbcType="BIGINT" />
    <result column="is_delete" property="isDelete" jdbcType="CHAR" />
    <result column="version" property="version" jdbcType="INTEGER" />
    <result column="memo" property="memo" jdbcType="VARCHAR" />
  </resultMap>
  
  <select id="findByQuestion" resultType="java.lang.Integer">
  	  select count(1) from us_t_user_answer 
  	  where question_id=#{t.questionId} 
  	    and user_id=#{t.userId} 
  	    and dest_user_id=#{t.destUserId}
  	    and is_delete = 0
  </select>
  
   <insert id="save" parameterType="com.runxsports.provider.cs.cms.entity.UserAnswer">
	  	insert into us_t_user_answer(question_id,user_id,dest_user_id,answer,create_date,create_user,last_update_date,last_update_user,memo)
		values(#{t.questionId},#{t.userId},#{t.destUserId},#{t.answer},now(),#{t.destUserId},now(),#{t.destUserId},#{t.memo})
  </insert>
  
  <delete id="deleteByUserId">
  	 update from us_t_user_answer set is_delete =1 
  	 where question_id=#{t.questionId} 
  	  and  user_id=#{t.userId} 
  	  and  dest_user_id=#{t.destUserId}
  </delete>
   
  <!-- 根据角色查询评价信息 -->
  <select id="queryByGroup">
      <!-- 学生自评 -->
     <if test="group == 0">
   		select q.question_content,
   		       a.answer,
   		       a.create_date,
   		       u.user_no,
   		       u.user_name,
   		       u.team_leader,
   		       u.teacher
		 from us_t_user_answer a
		left join us_t_question q on a.question_id = q.id and q.is_delete = 0
		left join us_t_user u on a.user_id = u.id and u.is_delete = 0
	  	where u.user_type = #{group} and a.is_delete = 0 and a.user_id = a.dest_user_id
     </if>
  	  
  	   <!-- 党支部评 -->
     <if test="group == 1">
  		select q.question_content,a.answer,a.create_date,u.user_no,u.user_name,
		r.user_no,r.user_name,u.team_leader,u.teacher
		 from us_t_user_answer a
		left join us_t_question q on a.question_id = q.id 
		left join us_t_user u on a.user_id = u.id and u.is_delete = 0
		left join us_t_user r on a.dest_user_id = r.id and r.is_delete = 0
	  	where u.user_type = #{group} and a.is_delete = 0  
     </if>
  	<!-- 党支部评 -->
     <if test="group == 2">
  		select q.question_content,a.answer,a.create_date,u.user_no,u.user_name,
		r.user_no,r.user_name,u.team_leader,u.teacher
		 from us_t_user_answer a
		left join us_t_question q on a.question_id = q.id 
		left join us_t_user u on a.user_id = u.id and u.is_delete = 0
		left join us_t_user r on a.dest_user_id = r.id and r.is_delete = 0
	  	where u.user_type = #{group} and a.is_delete = 0  
     </if>
  </select>
  
</mapper>